language: python
python: ['2.7']
sudo: required
services: [docker]

install:
  - docker pull kbase/kb-sdk
  - docker run kbase/kb-sdk genscript > $HOME/bin/kb-sdk
  - chmod 755 $HOME/bin/kb-sdk
  - export PATH=$PATH:$HOME/bin/kb-sdk
  - kb-sdk sdkbase
  - kb-sdk test || true
  - make build-test-script
  - sed -i "s/test_token=/test_token=$TEST_TOKEN/" test_local/test.cfg
  - sed -i 's/$(id -u)/0:0/' test_local/run_tests.sh

script:
  - kb-sdk test

after_success:
  - cp test_local/workdir/.coverage .
  - sudo mkdir -p /kb/module/lib/
  - sudo cp -R test_local/workdir/kb/module/lib/kb_deseq /kb/module/lib
  - coverage report -m
  - coveralls

env:
  global:
    secure: "V8MizLuagl1odA8qggfNev0r2hQNDgD4lAZ0h3Q+54FKiNqFBgdnrdu7JOlnKJIlNypaZ9QH96+lj219duFA79/CN3/kYTUUicUBX8xVfx7TGTPEYPlq5ReDXb8yisOHFwHVk8E34VrHgnI621+PmeORNNIMF8tTtYdluH78cpUGASteywRADbmEz0TdruHRVgU/ZlX10bREfiHPNLNUhOUGRLPJCfU63ZIoM/UvgR2S7y/6VA+1levlZ25dl32CLovAuFhL0owoAnFxhz2Bm7BJ60A1pt9JEiUkO7rfdLUMTGd39SzeNFYRz8ws3+xbEmKhCKlAy5v6wk6hXNZr3aVB0en+izrOXRvosz8XVoZZAQ/oLzJNDS5vVLqUfDdHYTPXV0jB28RK5hUoAlxbhP5wOJvGmmFj9sLPSitEWvNZ8PRarDxdScebZb9T34ZKlQwYpGcZPBGn1woLGcKv5LDaowVhmysPDo6yHKMPGTScjuJduwQW0slDpaZ+YIQ8wRwpXyXvKSicQOKRLYFUhaHAQe+/RxiBeSFGf5fOGHwntqYbtuoXd7wN+uxEfL6q6h7v8So6115EOHKPPAQP4hO2znP2/88IZlF6I6FwSC9w+ISF7FmmS4oJgstIw33OQwjRAZ1rG7O5IL91yiRU1wfoODCdOvwRhbGHI0sooUE="
